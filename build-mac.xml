<project name="moai-staging" default="build-all">

    <!-- ================================================================ -->
    <!-- macros -->
    <!-- ================================================================ -->
	<macrodef name="build">
		<attribute name="configuration"/>
		<attribute name="sdk"/>
		<sequential>
			<exec executable="xcodebuild" dir="xcode" failonerror="true" output="xcode/xcodebuild.cc.output">
				<arg line="-target Moai -configuration @{configuration} -sdk @{sdk} build"/>
			</exec>
		</sequential>
	</macrodef>

	<macrodef name="parse-errors">
		<attribute name="errorTag"/>
		<attribute name="contextSize"/>
		<sequential>
			<exec executable="grep" dir="xcode" outputproperty="grep.output">
				<arg line="-C @{contextSize} -e .*@{errorTag}.* xcodebuild.cc.output"/>
			</exec>
			<echo message="${grep.output}"/>
		</sequential>
	</macrodef>
	
    <!-- ================================================================ -->
    <!-- build all -->
    <!-- ================================================================ -->
    <target name="build-all">
		<build configuration="Distribution" sdk="iphoneos"/>
		<build configuration="Distribution" sdk="iphonesimulator"/>
		<build configuration="Debug" sdk="iphoneos"/>
		<build configuration="Debug" sdk="iphonesimulator"/>
	</target>
	
    <!-- ================================================================ -->
    <!-- output errors -->
    <!-- ================================================================ -->
	<target name="output-errors">
		<parse-errors errorTag="error:" contextSize="1"/>
	</target>
</project>